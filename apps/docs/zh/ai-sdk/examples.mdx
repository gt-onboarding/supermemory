---
title: "AI SDK 示例"
description: "完整示例展示如何将 Supermemory 与 Vercel AI SDK 搭配使用"
sidebarTitle: "示例"
---

本页提供使用 Supermemory 搭配 Vercel AI SDK 的完整示例，涵盖 Memory Tools 与 Infinite Chat 两种方式。

<div id="personal-assistant-with-memory-tools">
  ## 搭配 Memory Tools 的个人助理
</div>

构建一个能够记住用户偏好和过往互动的 AI 助手：

<CodeGroup>
  ```typescript Next.js API Route
  import { streamText } from 'ai'
  import { createAnthropic } from '@ai-sdk/anthropic'
  import { supermemoryTools } from '@supermemory/tools/ai-sdk'

  const anthropic = createAnthropic({
    apiKey: process.env.ANTHROPIC_API_KEY!
  })

  export async function POST(request: Request) {
    const { messages } = await request.json()

    const result = await streamText({
      model: anthropic('claude-3-sonnet-20240229'),
      messages,
      tools: supermemoryTools(process.env.SUPERMEMORY_API_KEY!),
      system: `You are a helpful personal assistant. When users share information about themselves,
      remember it using the addMemory tool. When they ask questions, search your memories to provide
      personalized responses. Always be proactive about remembering important details.`
    })

    return result.toAIStreamResponse()
  }
  ```

  ```typescript Client Component
  'use client'

  import { useChat } from 'ai/react'

  export default function PersonalAssistant() {
    const { messages, input, handleInputChange, handleSubmit } = useChat()

    return (
      <div className="flex flex-col h-screen max-w-2xl mx-auto p-4">
        <div className="flex-1 overflow-y-auto space-y-4">
          {messages.map((message) => (
            <div
              key={message.id}
              className={`p-4 rounded-lg ${
                message.role === 'user' ? 'bg-blue-100 ml-auto' : 'bg-gray-100'
              }`}
            >
              <p>{message.content}</p>
            </div>
          ))}
        </div>

        <form onSubmit={handleSubmit} className="mt-4">
          <input
            value={input}
            onChange={handleInputChange}
            placeholder="可以先介绍一下你自己，或向我提任何问题……"
            className="w-full p-2 border rounded"
          />
        </form>
      </div>
    )
  }
  ```
</CodeGroup>

**示例对话：**

* 用户：“我对花生过敏，而且喜欢意大利菜。”
* AI：*使用 addMemory 工具* “我已记住你对花生过敏，并且喜欢意大利菜！”
* 用户：“推荐一家晚餐餐厅。”
* AI：*使用 searchMemories 工具* “基于我对你的了解，我会推荐一家不含花生的意大利餐厅……”

<div id="customer-support-with-context">
  ## 具备上下文的客户支持
</div>

构建一套能够记住客户历史的客户支持系统：

```typescript
import { streamText } from 'ai'
import { createOpenAI } from '@ai-sdk/openai'
import { supermemoryTools } from '@supermemory/tools/ai-sdk'

const openai = createOpenAI({
  apiKey: process.env.OPENAI_API_KEY!
})

export async function POST(request: Request) {
  const { messages, customerId } = await request.json()

  const result = await streamText({
    model: openai('gpt-5'),
    messages,
    tools: supermemoryTools(process.env.SUPERMEMORY_API_KEY!, {
      containerTags: [customerId]
    }),
    system: `您是一名客户支持专员。在回复任何咨询之前：
    1. 搜索该客户之前的交互记录和问题
    2. 记住本次对话中分享的任何新信息
    3. 基于客户的历史记录提供个性化帮助
    4. 始终保持同理心，专注于解决问题`
  })

  return result.toAIStreamResponse()
}
```

<div id="infinite-chat-for-documentation">
  ## 文档场景的 Infinite Chat
</div>

创建一个具备无限上下文的文档助手：

<CodeGroup>
  ```typescript Documentation Chat
  import { streamText } from 'ai'

  const supermemoryInfiniteChat = createOpenAI({
    baseUrl: 'https://api.supermemory.ai/v3/https://api.openai.com/v1',
    apiKey: 'your-provider-api-key',
    headers: {
      'x-supermemory-api-key': 'supermemory-api-key',
      'x-sm-conversation-id': 'conversation-id'
    }
  })

  export async function POST(request: Request) {
    const { messages } = await request.json()

    const result = await streamText({
      model: supermemoryInfiniteChat('gpt-5'),
      messages,
      system: `You are a documentation assistant. You have access to all previous
      conversations and can reference earlier discussions. Help users understand
      the documentation by building on previous context.`
    })

    return result.toAIStreamResponse()
  }
  ```

  ```typescript Upload Documentation
  // 将文档上传到 memory 的独立端点
  import { addMemory } from '@supermemory/tools'

  export async function POST(request: Request) {
    const { content, title, url } = await request.json()

    const memory = await addMemory({
      apiKey: process.env.SUPERMEMORY_API_KEY!,
      content,
      title,
      url,
      headers: {
        'x-sm-conversation-id': 'documentation'
      }
    })

    return Response.json({ success: true, memory })
  }
  ```
</CodeGroup>

<div id="multi-user-learning-assistant">
  ## 多用户学习助手
</div>

构建一个能从多个用户中学习、但保持数据相互隔离的助手：

```typescript
import { streamText } from 'ai'
import { createAnthropic } from '@ai-sdk/anthropic'
import { supermemoryTools } from '@supermemory/tools/ai-sdk'

const anthropic = createAnthropic({
  apiKey: process.env.ANTHROPIC_API_KEY!
})

export async function POST(request: Request) {
  const { messages, userId, courseId } = await request.json()

  const result = await streamText({
    model: anthropic('claude-3-haiku-20240307'),
    messages,
    tools: supermemoryTools(process.env.SUPERMEMORY_API_KEY!, {
      containerTags: [userId]
    }),
    system: `你是一个学习助手。通过以下方式帮助学生完成学业：
    1. 记住他们的学习进度和遇到的困难
    2. 从他们过往的学习记录中搜索相关信息
    3. 根据他们的学习风格提供个性化的解释
    4. 跟踪他们已掌握的主题和仍需加强的主题`
  })

  return result.toAIStreamResponse()
}
```

<div id="research-assistant-with-file-processing">
  ## 支持文件处理的研究助理
</div>

将文件上传与 memory 工具结合，用于研究辅助：

<CodeGroup>
  ```typescript API Route
  import { streamText } from 'ai'
  import { createOpenAI } from '@ai-sdk/openai'
  import { supermemoryTools } from '@supermemory/tools/ai-sdk'

  const openai = createOpenAI({
    apiKey: process.env.OPENAI_API_KEY!
  })

  export async function POST(request: Request) {
    const { messages, projectId } = await request.json()

    const result = await streamText({
      model: openai('gpt-5'),
      messages,
      tools: supermemoryTools(process.env.SUPERMEMORY_API_KEY!, {
        containerTags: [projectId]
      }),
      system: `You are a research assistant. You can:
      1. Search through uploaded research papers and documents
      2. Remember key findings and insights from conversations
      3. Help synthesize information across multiple sources
      4. Track research progress and important discoveries`
    })

    return result.toAIStreamResponse()
  }
  ```

  ```typescript File Upload Handler
  import { addMemory } from '@supermemory/tools'

  export async function POST(request: Request) {
    const formData = await request.formData()
    const file = formData.get('file') as File
    const projectId = formData.get('projectId') as string

    // 上传文件并写入 memory
    const memory = await addMemory({
      apiKey: process.env.SUPERMEMORY_API_KEY!,
      content: file, // Supermemory 负责处理文件
      title: file.name,
      headers: {
        'x-sm-conversation-id': projectId
      }
    })

    return Response.json({
      success: true,
      message: "文档已上传并完成处理，适用于研究",
      memoryId: memory.id
    })
  }
  ```
</CodeGroup>

<div id="code-assistant-with-project-memory">
  ## 具备项目 memory 的代码助理
</div>

创建一款能记住你代码库与个人偏好的编码助理：

```typescript
import { streamText } from 'ai'
import { createAnthropic } from '@ai-sdk/anthropic'
import {
  supermemoryTools,
  searchMemoriesTool,
  addMemoryTool
} from '@supermemory/tools/ai-sdk'

const anthropic = createAnthropic({
  apiKey: process.env.ANTHROPIC_API_KEY!
})

export async function POST(request: Request) {
  const { messages, repositoryId } = await request.json()

  const result = await streamText({
    model: anthropic('claude-3-sonnet-20240229'),
    messages,
    tools: {
      // 使用独立工具以获得更精细的控制
      searchMemories: searchMemoriesTool(process.env.SUPERMEMORY_API_KEY!, {
        headers: {
          'x-sm-conversation-id': `repo-${repositoryId}`
        }
      }),
      addMemory: addMemoryTool(process.env.SUPERMEMORY_API_KEY!, {
        headers: {
          'x-sm-conversation-id': `repo-${repositoryId}`
        }
      }),
      // 添加自定义工具
      executeCode: {
        description: '在沙盒环境中执行代码',
        parameters: z.object({
          code: z.string(),
          language: z.string()
        }),
        execute: async ({ code, language }) => {
          // 您的代码执行逻辑
          return { result: "代码执行成功" }
        }
      }
    },
    system: `您是一个具有记忆功能的编程助手。您可以：
    1. 记住过往对话中的编程模式和偏好
    2. 搜索之前的代码示例和解决方案
    3. 跟踪项目架构和设计决策
    4. 从调试会话和常见问题中学习`
  })

  return result.toAIStreamResponse()
}
```

<div id="advanced-custom-tool-integration">
  ## 高级：自定义工具集成
</div>

将 Supermemory 工具与您自定义的工具结合使用：

```typescript
import { streamText } from 'ai'
import { createOpenAI } from '@ai-sdk/openai'
import { supermemoryTools } from '@supermemory/tools/ai-sdk'
import { z } from 'zod'

const openai = createOpenAI({
  apiKey: process.env.OPENAI_API_KEY!
})

// 日历集成的自定义工具
const calendarTool = {
  description: '创建日历事件',
  parameters: z.object({
    title: z.string(),
    date: z.string(),
    duration: z.number()
  }),
  execute: async ({ title, date, duration }) => {
    // 您的日历 API 集成
    return { eventId: "cal_123", message: "事件已创建" }
  }
}

export async function POST(request: Request) {
  const { messages } = await request.json()

  const result = await streamText({
    model: openai('gpt-5'),
    messages,
    tools: {
      // 展开 Supermemory 工具
      ...supermemoryTools(process.env.SUPERMEMORY_API_KEY!),
      // 添加自定义工具
      createEvent: calendarTool,
    },
    system: `您是一个能够记住信息并管理日历的个人助手。当用户提到事件或约会时：
    1. 使用 addMemory 记住详细信息
    2. 使用 createEvent 创建日历事件
    3. 使用 searchMemories 搜索冲突`
  })
  })
  return result.toAIStreamResponse()
}
}
```

<div id="environment-setup">
  ## 环境设置
</div>

在所有示例中，请确保已配置以下环境变量：

```bash .env.local
SUPERMEMORY_API_KEY=your_supermemory_key
OPENAI_API_KEY=your_openai_key
ANTHROPIC_API_KEY=your_anthropic_key
```

<div id="best-practices">
  ## 最佳实践
</div>

<div id="memory-tools">
  ### Memory Tools
</div>

* 使用更具描述性的 memory 内容以提升搜索效果
* 在系统提示中说明各工具的适用时机和上下文
* 使用项目标题区分不同用例
* 为工具故障实现错误处理

<div id="infinite-chat">
  ### Infinite Chat
</div>

* 使用会话 ID 以维护独立的聊天上下文
* 搭配用户 ID 实现个性化体验
* 试用不同的 provider，找到最契合你的用例的方案
* 监控 token 使用量，以优化成本

<div id="general-tips">
  ### 通用建议
</div>

* 从简单示例入手，逐步增加复杂度
* 使用搜索功能避免重复的记忆存储
* 为生产环境实施完善的身份验证
* 对高并发/高流量应用考虑设置速率限制

<div id="next-steps">
  ## 下一步
</div>

<CardGroup cols={2}>
  <Card title="Memory API" icon="database" href="/zh/memory-api/overview">
    通过完整 API 控制的高级 memory 管理
  </Card>

  <Card title="Memory Router" icon="route" href="/zh/memory-router/overview">
    适用于现有 LLM 应用的即插即用代理
  </Card>
</CardGroup>