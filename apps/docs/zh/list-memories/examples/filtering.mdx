---
title: "记忆存储的筛选"
description: "使用基于 SQL 的过滤，通过容器标签和 Metadata 筛选记忆存储"
---

使用容器标签和 Metadata 来筛选记忆存储。该过滤系统基于 SQL 查询构造，因此你需要像编写数据库查询那样构建你的 filters。

<div id="filter-by-container-tags">
  ## 按容器标签筛选
</div>

容器标签采用精确数组匹配——memory 必须拥有完全相同且顺序一致的标签。

<Tabs>
  <Tab title="TypeScript">
    ```typescript
    // 单个标签——仅匹配标签正好为 ["user_123"] 的 memories
    const userMemories = await client.memories.list({
      containerTags: ["user_123"]
    });

    // 多个标签——仅匹配标签正好为 ["user_123", "project_ai"] 的 memories
    const projectMemories = await client.memories.list({
      containerTags: ["user_123", "project_ai"]
    });
    ```
  </Tab>
  <Tab title="Python">
    ```python
    # 单个标签
    user_memories = client.memories.list(container_tags=["user_123"])

    # 多个标签（精确匹配）
    project_memories = client.memories.list(
        container_tags=["user_123", "project_ai"]
    )
    ```
  </Tab>
  <Tab title="cURL">
    ```bash
    # 单个标签
    curl -X POST "https://api.supermemory.ai/v3/documents/list" \
      -H "Authorization: Bearer $SUPERMEMORY_API_KEY" \
      -H "Content-Type: application/json" \
      -d '{"containerTags": ["user_123"]}'

    # 多个标签
    curl -X POST "https://api.supermemory.ai/v3/documents/list" \
      -H "Authorization: Bearer $SUPERMEMORY_API_KEY" \
      -H "Content-Type: application/json" \
      -d '{"containerTags": ["user_123", "project_ai"]}'
    ```
  </Tab>
</Tabs>

<div id="metadata-filtering-with-sql-logic">
  ## 使用 SQL 逻辑进行 Metadata 过滤
</div>

`filters` 参数支持使用类 SQL 的查询结构按 Metadata 字段进行过滤。由于后端采用 SQL 查询构造，你需要像编写数据库查询一样组织你的 filters，并显式使用 AND/OR 逻辑。

<div id="why-this-structure">
  ### 为什么采用这种结构？
</div>

在 SQL 数据库中，`AND` 的优先级高于 `OR`。如果不进行显式分组，类似下面的查询：

```
category = 'programming' OR framework = 'react' AND difficulty = 'advanced'
```

可解释为：

```
category = 'programming' OR (framework = 'react' AND difficulty = 'advanced')
```

JSON 结构要求显式分组，以避免产生意外结果。

<Info>
  **筛选器结构规则：**

  * 始终将条件置于 `AND` 或 `OR` 数组中（即使只有一个条件）
  * 使用 `JSON.stringify()` 将筛选对象序列化为字符串
  * 每个条件都需要包含 `key`、`value` 和 `negate` 属性
  * 常规匹配使用 `negate: false`，排除匹配使用 `negate: true`
</Info>


<div id="simple-metadata-filter">
  ### 简单的 Metadata 过滤
</div>

<Tabs>
  <Tab title="TypeScript">
    ```typescript
    // 按单个 Metadata 字段过滤
    const programmingMemories = await client.memories.list({
      filters: JSON.stringify({
        AND: [
          { key: "category", value: "programming", negate: false }
        ]
      })
    });
    ```
  </Tab>
  <Tab title="Python">
    ```python
    import json

    # 按单个 Metadata 字段过滤
    programming_memories = client.memories.list(
        filters=json.dumps({
            "AND": [
                {"key": "category", "value": "programming", "negate": False}
            ]
        })
    )
    ```
  </Tab>
  <Tab title="cURL">
    ```bash
    curl -X POST "https://api.supermemory.ai/v3/documents/list" \
      -H "Authorization: Bearer $SUPERMEMORY_API_KEY" \
      -H "Content-Type: application/json" \
      -d '{
        "filters": "{\"AND\":[{\"key\":\"category\",\"value\":\"programming\",\"negate\":false}]}"
      }'
    ```
  </Tab>
</Tabs>

<div id="multiple-conditions-and-logic">
  ### 多条件（AND 逻辑）
</div>

<Tabs>
  <Tab title="TypeScript">
    ```typescript
    // 所有条件均需满足
    const reactTutorials = await client.memories.list({
      filters: JSON.stringify({
        AND: [
          { key: "category", value: "tutorial", negate: false },
          { key: "framework", value: "react", negate: false },
          { key: "difficulty", value: "beginner", negate: false }
        ]
      })
    });
    ```
  </Tab>
  <Tab title="Python">
    ```python
    # 所有条件均需满足
    react_tutorials = client.memories.list(
        filters=json.dumps({
            "AND": [
                {"key": "category", "value": "tutorial", "negate": False},
                {"key": "framework", "value": "react", "negate": False},
                {"key": "difficulty", "value": "beginner", "negate": False}
            ]
        })
    )
    ```
  </Tab>
  <Tab title="cURL">
    ```bash
    curl -X POST "https://api.supermemory.ai/v3/documents/list" \
      -H "Authorization: Bearer $SUPERMEMORY_API_KEY" \
      -H "Content-Type: application/json" \
      -d '{
        "filters": "{\"AND\":[{\"key\":\"category\",\"value\":\"tutorial\",\"negate\":false},{\"key\":\"framework\",\"value\":\"react\",\"negate\":false}]}"
      }'
    ```
  </Tab>
</Tabs>

<div id="alternative-conditions-or-logic">
  ### 备选条件（OR 逻辑）
</div>

<Tabs>
  <Tab title="TypeScript">
    ```typescript
    // 满足任一条件即可匹配
    const frontendMemories = await client.memories.list({
      filters: JSON.stringify({
        OR: [
          { key: "framework", value: "react", negate: false },
          { key: "framework", value: "vue", negate: false },
          { key: "framework", value: "angular", negate: false }
        ]
      })
    });
    ```
  </Tab>
  <Tab title="Python">
    ```python
    # 满足任一条件即可匹配
    frontend_memories = client.memories.list(
        filters=json.dumps({
            "OR": [
                {"key": "framework", "value": "react", "negate": False},
                {"key": "framework", "value": "vue", "negate": False},
                {"key": "framework", "value": "angular", "negate": False}
            ]
        })
    )
    ```
  </Tab>
  <Tab title="cURL">
    ```bash
    curl -X POST "https://api.supermemory.ai/v3/documents/list" \
      -H "Authorization: Bearer $SUPERMEMORY_API_KEY" \
      -H "Content-Type: application/json" \
      -d '{
        "filters": "{\"OR\":[{\"key\":\"framework\",\"value\":\"react\",\"negate\":false},{\"key\":\"framework\",\"value\":\"vue\",\"negate\":false}]}"
      }'
    ```
  </Tab>
</Tabs>

<div id="complex-nested-logic">
  ### 复杂嵌套逻辑
</div>

<Tabs>
  <Tab title="TypeScript">
    ```typescript
    // 复杂逻辑：programming AND（react OR 高级难度）
    const advancedContent = await client.memories.list({
      filters: JSON.stringify({
        AND: [
          { key: "category", value: "programming", negate: false },
          {
            OR: [
              { key: "framework", value: "react", negate: false },
              { key: "difficulty", value: "advanced", negate: false }
            ]
          }
        ]
      })
    });
    ```
  </Tab>
  <Tab title="Python">
    ```python
    # 复杂逻辑：programming AND（react OR 高级难度）
    advanced_content = client.memories.list(
        filters=json.dumps({
            "AND": [
                {"key": "category", "value": "programming", "negate": False},
                {
                    "OR": [
                        {"key": "framework", "value": "react", "negate": False},
                        {"key": "difficulty", "value": "advanced", "negate": False}
                    ]
                }
            ]
        })
    )
    ```
  </Tab>
  <Tab title="cURL">
    ```bash
    curl -X POST "https://api.supermemory.ai/v3/documents/list" \
      -H "Authorization: Bearer $SUPERMEMORY_API_KEY" \
      -H "Content-Type: application/json" \
      -d '{
        "filters": "{\"AND\":[{\"key\":\"category\",\"value\":\"programming\",\"negate\":false},{\"OR\":[{\"key\":\"framework\",\"value\":\"react\",\"negate\":false},{\"key\":\"difficulty\",\"value\":\"advanced\",\"negate\":false}]}]}"
      }'
    ```
  </Tab>
</Tabs>

<div id="array-contains-filtering">
  ## 数组“包含”过滤
</div>

筛选在数组字段（如 participants、tags、team members）中包含特定值的记忆存储。

<div id="basic-array-contains">
  ### 基本用法：Array Contains
</div>

<Tabs>
  <Tab title="TypeScript">
    ```typescript
    // 查找 john.doe 参与的记忆存储
    const meetingMemories = await client.memories.list({
      filters: JSON.stringify({
        AND: [
          {
            key: "participants",
            value: "john.doe",
            filterType: "array_contains",
            negate: false
          }
        ]
      })
    });
    ```
  </Tab>
  <Tab title="Python">
    ```python
    # 查找 john.doe 参与的记忆存储
    meeting_memories = client.memories.list(
        filters=json.dumps({
            "AND": [
                {
                    "key": "participants",
                    "value": "john.doe",
                    "filterType": "array_contains",
                    "negate": False
                }
            ]
        })
    )
    ```
  </Tab>
  <Tab title="cURL">
    ```bash
    curl -X POST "https://api.supermemory.ai/v3/documents/list" \
      -H "Authorization: Bearer $SUPERMEMORY_API_KEY" \
      -H "Content-Type: application/json" \
      -d '{
        "filters": "{\"AND\":[{\"key\":\"participants\",\"value\":\"john.doe\",\"filterType\":\"array_contains\",\"negate\":false}]}"
      }'
    ```
  </Tab>
</Tabs>

<div id="array-contains-with-exclusion">
  ### 使用排除的 array_contains
</div>

<Tabs>
  <Tab title="TypeScript">
    ```typescript
    // 查找不包含特定团队成员的 memory
    const filteredMemories = await client.memories.list({
      filters: JSON.stringify({
        AND: [
          {
            key: "reviewers",
            value: "external.consultant",
            filterType: "array_contains",
            negate: true  // 排除包含外部顾问的 memory
          },
          {
            key: "project_tags",
            value: "internal-only",
            filterType: "array_contains",
            negate: false
          }
        ]
      })
    });
    ```
  </Tab>
  <Tab title="Python">
    ```python
    # 查找不包含特定团队成员的 memory
    filtered_memories = client.memories.list(
        filters=json.dumps({
            "AND": [
                {
                    "key": "reviewers",
                    "value": "external.consultant",
                    "filterType": "array_contains",
                    "negate": True  # 排除包含外部顾问的 memory
                },
                {
                    "key": "project_tags",
                    "value": "internal-only",
                    "filterType": "array_contains",
                    "negate": False
                }
            ]
        })
    )
    ```
  </Tab>
  <Tab title="cURL">
    ```bash
    curl -X POST "https://api.supermemory.ai/v3/documents/list" \
      -H "Authorization: Bearer $SUPERMEMORY_API_KEY" \
      -H "Content-Type: application/json" \
      -d '{
        "filters": "{\"AND\":[{\"key\":\"reviewers\",\"value\":\"external.consultant\",\"filterType\":\"array_contains\",\"negate\":true},{\"key\":\"project_tags\",\"value\":\"internal-only\",\"filterType\":\"array_contains\",\"negate\":false}]}"
      }'
    ```
  </Tab>
</Tabs>

<div id="multiple-array-contains-or-logic">
  ### 多个数组包含（OR 逻辑）
</div>

<Tabs>
  <Tab title="TypeScript">
    ```typescript
    // 查找涉及任一团队负责人的 memory
    const leadershipMemories = await client.memories.list({
      filters: JSON.stringify({
        OR: [
          {
            key: "attendees",
            value: "engineering.lead",
            filterType: "array_contains"
          },
          {
            key: "attendees",
            value: "product.lead",
            filterType: "array_contains"
          },
          {
            key: "attendees",
            value: "design.lead",
            filterType: "array_contains"
          }
        ]
      }),
      sort: "updatedAt",
      order: "desc"
    });
    ```
  </Tab>
  <Tab title="Python">
    ```python
    # 查找涉及任一团队负责人的 memory
    leadership_memories = client.memories.list(
        filters=json.dumps({
            "OR": [
                {
                    "key": "attendees",
                    "value": "engineering.lead",
                    "filterType": "array_contains"
                },
                {
                    "key": "attendees",
                    "value": "product.lead",
                    "filterType": "array_contains"
                },
                {
                    "key": "attendees",
                    "value": "design.lead",
                    "filterType": "array_contains"
                }
            ]
        }),
        sort="updatedAt",
        order="desc"
    )
    ```
  </Tab>
  <Tab title="cURL">
    ```bash
    curl -X POST "https://api.supermemory.ai/v3/documents/list" \
      -H "Authorization: Bearer $SUPERMEMORY_API_KEY" \
      -H "Content-Type: application/json" \
      -d '{
        "filters": "{\"OR\":[{\"key\":\"attendees\",\"value\":\"engineering.lead\",\"filterType\":\"array_contains\"},{\"key\":\"attendees\",\"value\":\"product.lead\",\"filterType\":\"array_contains\"},{\"key\":\"attendees\",\"value\":\"design.lead\",\"filterType\":\"array_contains\"}]}",
        "sort": "updatedAt",
        "order": "desc"
      }'
    ```
  </Tab>
</Tabs>

<div id="combined-container-tags-metadata-filtering">
  ## 组合使用 Container Tags 与 Metadata 筛选
</div>

<Tabs>
  <Tab title="TypeScript">
    ```typescript
    const filteredMemories = await client.memories.list({
      containerTags: ["user_123"],
      filters: JSON.stringify({
        AND: [
          { key: "category", value: "tutorial", negate: false },
          { key: "framework", value: "react", negate: false }
        ]
      }),
      sort: "updatedAt",
      order: "desc",
      limit: 50
    });
    ```
  </Tab>
  <Tab title="Python">
    ```python
    filtered_memories = client.memories.list(
        container_tags=["user_123"],
        filters=json.dumps({
            "AND": [
                {"key": "category", "value": "tutorial", "negate": False},
                {"key": "framework", "value": "react", "negate": False}
            ]
        }),
        sort="updatedAt",
        order="desc",
        limit=50
    )
    ```
  </Tab>
  <Tab title="cURL">
    ```bash
    curl -X POST "https://api.supermemory.ai/v3/documents/list" \
      -H "Authorization: Bearer $SUPERMEMORY_API_KEY" \
      -H "Content-Type: application/json" \
      -d '{
        "containerTags": ["user_123"],
        "filters": "{\"AND\":[{\"key\":\"category\",\"value\":\"tutorial\",\"negate\":false},{\"key\":\"framework\",\"value\":\"react\",\"negate\":false}]}",
        "sort": "updatedAt",
        "order": "desc",
        "limit": 50
      }'
    ```
  </Tab>
</Tabs>

<Warning>
**常见错误：**
- 直接使用裸条件对象：`{"key": "category", "value": "programming"}`
- 忘记调用 JSON.stringify：传入对象而非字符串
- 缺少 negate 属性：务必包含 `"negate": false` 或 `"negate": true`
</Warning>

<Note>
**Container Tags 与 Metadata 筛选对比：**
- Container tags：用于组织分组的精确数组匹配
- Metadata 筛选：在自定义 Metadata 字段上进行类 SQL 的复杂逻辑查询
- 二者可组合，以实现更强大的筛选能力
</Note>