---
title: "Filtrage"
description: "Apprenez à filtrer le contenu lors de vos recherches avec supermemory"
icon: "list-filter-plus"
---

<div id="container-tag">
  ## Étiquette de conteneur
</div>

Une étiquette de conteneur est un identifiant pour vos utilisateurs finaux, permettant de regrouper des memories.

Cela peut être :

- Un utilisateur de votre produit
- Une organisation cliente d’un SaaS

Un identifiant de projet, ou même un identifiant dynamique comme `user_project_etc`.

Nous recommandons d’utiliser un seul containerTag dans toutes les requêtes API.

Le graphe est construit à partir des étiquettes de conteneur. Par exemple, chaque utilisateur/étiquette dans votre compte supermemory aura un graphe unique qui lui est dédié.

<CodeGroup>

```bash cURL
curl https://api.supermemory.ai/v3/search \
  --request POST \
  --header 'Content-Type: application/json' \
  --header 'Authorization: Bearer SUPERMEMORY_API_KEY' \
  --data '{
    "q": "machine learning",
    "containerTags": ["user_123"]
  }'
```

```typescript Typescript
await client.search.execute({
  q: "machine learning",
  containerTags: ["user_123"],
});
```

```python Python
client.search.execute(
    q="machine learning",
    containerTags=["user_123"]
)
```

</CodeGroup>

<div id="metadata">
  ## Metadata
</div>

Parfois, vous pouvez vouloir ajouter des Metadata et effectuer un filtrage avancé basé sur celles-ci.

Avec le filtrage par Metadata, vous pouvez rechercher selon :

- Conditions AND et OR
- Correspondance de chaînes
- Correspondance numérique
- Correspondance de dates
- Requêtes sur des plages de temps

<div id="validation-rules-limits">
  ### Règles de validation et limites
</div>

Pour garantir des performances et une sécurité optimales, le système de filtrage impose les limites suivantes :

- **Clés de metadata** : Doivent contenir uniquement des caractères alphanumériques, des underscores et des tirets (`/^[a-zA-Z0-9_-]+$/`)
- **Longueur des clés de metadata** : 64 caractères maximum
- **Nombre maximal de conditions** : Jusqu’à 200 conditions par requête
- **Profondeur maximale d’imbrication** : Jusqu’à 8 niveaux d’expressions AND/OR imbriquées
- **Opérateurs valides** : `=`, `!=`, `<`, `<=`, `>`, `>=` pour le filtrage numérique

<Warning>
Ces limites permettent d’éviter des requêtes trop complexes susceptibles d’affecter les performances. Si vous devez filtrer davantage de conditions, envisagez de scinder votre requête en plusieurs requêtes ou d’utiliser des termes de recherche plus larges avec un post-traitement.
</Warning>

<CodeGroup>

```bash cURL
curl https://api.supermemory.ai/v3/search \
  --request POST \
  --header 'Content-Type: application/json' \
  --header 'Authorization: Bearer SUPERMEMORY_API_KEY' \
  --data '{
    "q": "machine learning",
    "filters": {
        "AND": [
            {
                "key": "category",
                "value": "technology",
                "negate": false
            },
            {
                "filterType": "numeric",
                "key": "readingTime",
                "value": "5",
                "negate": false,
                "numericOperator": "<="
            }
        ]
    }
}'
```

```typescript Typescript
await client.search.execute({
  q: "machine learning",
  filters: {
    AND: [
      {
        key: "category",
        value: "technology",
        negate: false,
      },
      {
        filterType: "numeric",
        key: "readingTime",
        value: "5",
        negate: false,
        numericOperator: "<=",
      },
    ],
  },
});
```

```python Python
client.search.execute(
    q="machine learning",
    filters={
        "AND": [
            {
                "key": "category",
                "value": "technology",
                "negate": false
            },
            {
                "filterType": "numeric",
                "key": "readingTime",
                "value": "5",
                "negate": false,
                "numericOperator": "<="
            }
        ]
    }
)
```

</CodeGroup>

<div id="array-contains-filtering">
  ## Filtrage avec array_contains
</div>

Vous pouvez filtrer des memory par valeurs de tableau en utilisant le type de filtre `array_contains`. C’est particulièrement utile pour filtrer par participants ou par d’autres metadata de type tableau.

Commencez par créer une memory avec des participants dans les metadata :

<CodeGroup>

```bash cURL
curl --location 'https://api.supermemory.ai/v3/documents' \
--header 'Content-Type: application/json' \
--header 'Authorization: Bearer SUPERMEMORY_API_KEY' \
--data '{
    "content": "quarterly planning meeting discussion",
    "metadata": {
        "participants": ["john.doe", "sarah.smith", "mike.wilson"]
    }
  }'
```

```typescript Typescript
await client.memories.create({
  content: "quarterly planning meeting discussion",
  metadata: {
    participants: ["john.doe", "sarah.smith", "mike.wilson"]
  }
});
```

```python Python
client.memories.create(
    content="quarterly planning meeting discussion",
    metadata={
        "participants": ["john.doe", "sarah.smith", "mike.wilson"]
    }
)
```

</CodeGroup>

Ensuite, effectuez une recherche en utilisant le filtre `array_contains` :

<CodeGroup>

```bash cURL
curl --location 'https://api.supermemory.ai/v3/search' \
--header 'Content-Type: application/json' \
--header 'Authorization: Bearer SUPERMEMORY_API_KEY' \
--data '{
    "q": "meeting",
    "filters": {
      "AND": [
        {
          "key": "participants",
          "value": "john.doe",
          "filterType": "array_contains"
        }
      ]
    },
    "limit": 5
  }'
```

```typescript Typescript
await client.search.execute({
  q: "meeting",
  filters: {
    AND: [
      {
        key: "participants",
        value: "john.doe",
        filterType: "array_contains"
      }
    ]
  },
  limit: 5
});
```

```python Python
client.search.execute(
    q="meeting",
    filters={
        "AND": [
            {
                "key": "participants",
                "value": "john.doe",
                "filterType": "array_contains"
            }
        ]
    },
    limit=5
)
```

</CodeGroup>

<div id="migration-notes">
  ## Notes de migration
</div>

<Note>
**Modifications majeures** : Des mises à jour récentes du système de filtrage ont introduit des règles de validation plus strictes. Si vous rencontrez des erreurs de validation de filtre, veuillez vérifier les points suivants :

1. **Format des clés de Metadata** : Assurez-vous que toutes les clés de metadata ne contiennent que des caractères alphanumériques, des underscores et des tirets. Les clés comportant des espaces, des points ou d'autres caractères spéciaux échoueront désormais à la validation.

2. **Longueur des clés** : Les clés de metadata doivent compter 64 caractères ou moins.

3. **Complexité du filtre** : Les requêtes comportant plus de 200 conditions ou plus de 8 niveaux d'imbrication seront rejetées.

**Exemples de clés invalides à corriger** :
- `"user.email"` → `"user_email"`
- `"reading time"` → `"reading_time"`
- `"category-with-very-long-name-that-exceeds-the-limit"` → `"category_name"`
</Note>

<div id="document">
  ## Document
</div>

Vous pouvez également rechercher des segments au sein d’un document précis et volumineux.

Cela est particulièrement utile pour des documents très volumineux, comme des livres, des podcasts, etc.

<CodeGroup>

```bash cURL
curl https://api.supermemory.ai/v3/search \
  --request POST \
  --header 'Content-Type: application/json' \
  --header 'Authorization: Bearer SUPERMEMORY_API_KEY' \
  --data '{
    "q": "machine learning",
    "docId": "doc_123"
  }'
```

```typescript Typescript
await client.search.execute({
  q: "machine learning",
  docId: "doc_123",
});
```

```python Python
client.search.execute(
    q="machine learning",
    docId="doc_123"
)
```

</CodeGroup>