---
title: "AI SDK 連携"
description: "Supermemory と Vercel AI SDK を用いてインテリジェントなアプリケーションを構築するための包括的なサンプル集"
---

このページでは、Supermemory を Vercel AI SDK と組み合わせて活用する方法を、Memory Tools と Infinite Chat の両アプローチにわたって網羅的なサンプルで紹介します。

<div id="personal-assistant-with-memory-tools">
  ## Memory Tools を使ったパーソナルアシスタント
</div>

ユーザーの好みや過去のやり取りを記憶する AI アシスタントを構築します:

<CodeGroup>
  ```typescript Next.js API Route
  import { streamText } from 'ai'
  import { createAnthropic } from '@ai-sdk/anthropic'
  import { supermemoryTools } from '@supermemory/tools/ai-sdk'

  const anthropic = createAnthropic({
    apiKey: process.env.ANTHROPIC_API_KEY!
  })

  export async function POST(request: Request) {
    const { messages } = await request.json()

    const result = await streamText({
      model: anthropic('claude-3-sonnet-20240229'),
      messages,
      tools: supermemoryTools(process.env.SUPERMEMORY_API_KEY!),
      system: `You are a helpful personal assistant. When users share information about themselves,
      remember it using the addMemory tool. When they ask questions, search your memories to provide
      personalized responses. Always be proactive about remembering important details.`
    })

    return result.toAIStreamResponse()
  }
  ```

  ```typescript Client Component
  'use client'

  import { useChat } from 'ai/react'

  export default function PersonalAssistant() {
    const { messages, input, handleInputChange, handleSubmit } = useChat()

    return (
      <div className="flex flex-col h-screen max-w-2xl mx-auto p-4">
        <div className="flex-1 overflow-y-auto space-y-4">
          {messages.map((message) => (
            <div
              key={message.id}
              className={`p-4 rounded-lg ${
                message.role === 'user' ? 'bg-blue-100 ml-auto' : 'bg-gray-100'
              }`}
            >
              <p>{message.content}</p>
            </div>
          ))}
        </div>

        <form onSubmit={handleSubmit} className="mt-4">
          <input
            value={input}
            onChange={handleInputChange}
            placeholder="あなたのことを教えてください。質問もどうぞ…"
            className="w-full p-2 border rounded"
          />
        </form>
      </div>
    )
  }
  ```
</CodeGroup>

**会話例:**

* ユーザー: &quot;私はピーナッツアレルギーで、イタリア料理が大好きです&quot;
* AI: *addMemory ツールを使用* &quot;ピーナッツアレルギーで、イタリア料理がお好きなことを記憶しました！&quot;
* ユーザー: &quot;夕食のレストランを提案して&quot;
* AI: *searchMemories ツールを使用* &quot;把握している情報に基づくと、ピーナッツ不使用のイタリアンレストランをおすすめします…&quot;

<div id="customer-support-with-context">
  ## 文脈を活用したカスタマーサポート
</div>

顧客の履歴を記憶するカスタマーサポートシステムを構築します：

```typescript
import { streamText } from 'ai'
import { createOpenAI } from '@ai-sdk/openai'
import { supermemoryTools } from '@supermemory/tools/ai-sdk'

const openai = createOpenAI({
  apiKey: process.env.OPENAI_API_KEY!
})

export async function POST(request: Request) {
  const { messages, customerId } = await request.json()

  const result = await streamText({
    model: openai('gpt-5'),
    messages,
    tools: supermemoryTools(process.env.SUPERMEMORY_API_KEY!, {
      containerTags: [customerId]
    }),
    system: `あなたはカスタマーサポートエージェントです。問い合わせに回答する前に、必ず以下を実行してください：
    1. お客様の過去のやり取りと問題を検索する
    2. この会話で共有された新しい情報を記憶する
    3. お客様の履歴に基づいてパーソナライズされたサポートを提供する
    4. 常に共感的で解決志向の対応を心がける`
  })

  return result.toAIStreamResponse()
}
```

<div id="infinite-chat-for-documentation">
  ## ドキュメント向け Infinite Chat
</div>

無制限のコンテキストで動作するドキュメントアシスタントを作成します：

<CodeGroup>
  ```typescript Documentation Chat
  import { streamText } from 'ai'

  const infiniteChat = createOpenAI({
    baseUrl: 'https://api.supermemory.ai/v3/https://api.openai.com/v1',
    apiKey: 'your-provider-api-key',
    headers: {
      'x-supermemory-api-key': 'supermemory-api-key',
      'x-sm-conversation-id': 'conversation-id'
    }
  })

  export async function POST(request: Request) {
    const { messages } = await request.json()

    const result = await streamText({
      model: infiniteChat('gpt-5'),
      messages,
      system: `You are a documentation assistant. You have access to all previous
      conversations and can reference earlier discussions. Help users understand
      the documentation by building on previous context.`
    })

    return result.toAIStreamResponse()
  }
  ```

  ```typescript Upload Documentation
  // メモリーにドキュメントをアップロードするための別エンドポイント
  import { addMemory } from '@supermemory/tools'

  export async function POST(request: Request) {
    const { content, title, url } = await request.json()

    const memory = await addMemory({
      apiKey: process.env.SUPERMEMORY_API_KEY!,
      content,
      title,
      url,
      headers: {
        'x-sm-conversation-id': 'documentation'
      }
    })

    return Response.json({ success: true, memory })
  }
  ```
</CodeGroup>

<div id="multi-user-learning-assistant">
  ## マルチユーザー学習アシスタント
</div>

複数ユーザーから学習しつつ、データはユーザーごとに分離して保持するアシスタントを構築します：

```typescript
import { streamText } from 'ai'
import { createAnthropic } from '@ai-sdk/anthropic'
import { supermemoryTools } from '@supermemory/tools/ai-sdk'

const anthropic = createAnthropic({
  apiKey: process.env.ANTHROPIC_API_KEY!
})

export async function POST(request: Request) {
  const { messages, userId, courseId } = await request.json()

  const result = await streamText({
    model: anthropic('claude-3-haiku-20240307'),
    messages,
    tools: supermemoryTools(process.env.SUPERMEMORY_API_KEY!, {
      containerTags: [userId]
    }),
    system: `あなたは学習アシスタントです。以下の方法で学生の学習をサポートしてください：
    1. 学習の進捗と苦手な分野を記憶する
    2. 過去のセッションから関連情報を検索する
    3. 学習スタイルに基づいてパーソナライズされた説明を提供する
    4. 習得済みのトピックと更なる支援が必要なトピックを追跡する`
  })

  return result.toAIStreamResponse()
}
```

<div id="research-assistant-with-file-processing">
  ## ファイル処理対応のリサーチアシスタント
</div>

ファイルのアップロードとメモリー用ツールを組み合わせて、リサーチを支援します:

<CodeGroup>
  ```typescript API Route
  import { streamText } from 'ai'
  import { createOpenAI } from '@ai-sdk/openai'
  import { supermemoryTools } from '@supermemory/tools/ai-sdk'

  const openai = createOpenAI({
    apiKey: process.env.OPENAI_API_KEY!
  })

  export async function POST(request: Request) {
    const { messages, projectId } = await request.json()

    const result = await streamText({
      model: openai('gpt-5'),
      messages,
      tools: supermemoryTools(process.env.SUPERMEMORY_API_KEY!, {
        containerTags: [projectId]
      }),
      system: `You are a research assistant. You can:
      1. Search through uploaded research papers and documents
      2. Remember key findings and insights from conversations
      3. Help synthesize information across multiple sources
      4. Track research progress and important discoveries`
    })

    return result.toAIStreamResponse()
  }
  ```

  ```typescript File Upload Handler
  import { addMemory } from '@supermemory/tools'

  export async function POST(request: Request) {
    const formData = await request.formData()
    const file = formData.get('file') as File
    const projectId = formData.get('projectId') as string

    // ファイルをアップロードしてメモリーに追加
    const memory = await addMemory({
      apiKey: process.env.SUPERMEMORY_API_KEY!,
      content: file, // Supermemory がファイル処理を行います
      title: file.name,
      headers: {
        'x-sm-conversation-id': projectId
      }
    })

    return Response.json({
      success: true,
      message: "研究用にドキュメントをアップロードして処理しました",
      memoryId: memory.id
    })
  }
  ```
</CodeGroup>

<div id="code-assistant-with-project-memory">
  ## プロジェクトメモリー対応コードアシスタント
</div>

コードベースや設定・好みを記憶するコーディングアシスタントを作成します：

```typescript
import { streamText } from 'ai'
import { createAnthropic } from '@ai-sdk/anthropic'
import {
  supermemoryTools,
  searchMemoriesTool,
  addMemoryTool
} from '@supermemory/tools/ai-sdk'

const anthropic = createAnthropic({
  apiKey: process.env.ANTHROPIC_API_KEY!
})

export async function POST(request: Request) {
  const { messages, repositoryId } = await request.json()

  const result = await streamText({
    model: anthropic('claude-3-sonnet-20240229'),
    messages,
    tools: {
      // より細かい制御のために個別のツールを使用
      searchMemories: searchMemoriesTool(process.env.SUPERMEMORY_API_KEY!, {
        headers: {
        }
      }),
      addMemory: addMemoryTool(process.env.SUPERMEMORY_API_KEY!, {
        headers: {
        }
      }),
      // カスタムツールを追加
      executeCode: {
        description: 'サンドボックス環境でコードを実行',
        parameters: z.object({
          code: z.string(),
          language: z.string()
        }),
        execute: async ({ code, language }) => {
          // コード実行ロジック
          return { result: "コードが正常に実行されました" }
        }
      }
    },
    system: `あなたはメモリー機能を持つコーディングアシスタントです。以下のことができます：
    1. 過去の会話からコーディングパターンと設定を記憶する
    2. 以前のコード例とソリューションを検索する
    3. プロジェクトアーキテクチャと設計決定を追跡する
    4. デバッグセッションと一般的な問題から学習する`
  })

  return result.toAIStreamResponse()
}
```

<div id="advanced-custom-tool-integration">
  ## 上級: カスタムツールの統合
</div>

Supermemory のツールを独自のカスタムツールと組み合わせます:

```typescript
import { streamText } from 'ai'
import { createOpenAI } from '@ai-sdk/openai'
import { supermemoryTools } from '@supermemory/tools/ai-sdk'
import { z } from 'zod'

const openai = createOpenAI({
  apiKey: process.env.OPENAI_API_KEY!
})

// カレンダー連携のためのカスタムツール
const calendarTool = {
  description: 'カレンダーイベントを作成'
  parameters: z.object({
    title: z.string(),
    date: z.string(),
    duration: z.number()
  }),
  execute: async ({ title, date, duration }) => {
    // カレンダー API との統合処理を実装
    return { eventId: "cal_123", message: "イベントを作成しました" }
  }
}

export async function POST(request: Request) {
  const { messages } = await request.json()

  const result = await streamText({
    model: openai('gpt-5'),
    messages,
    tools: {
      // Supermemory のツールをスプレッド
      ...supermemoryTools(process.env.SUPERMEMORY_API_KEY!),
      // カスタムツールを追加
      createEvent: calendarTool,
    },
    system: `あなたは情報を記憶し、カレンダーを管理できるパーソナルアシスタントです。
    ユーザーがイベントや予定に言及したときは、次を行ってください:
    1. addMemory を使って詳細を記憶する
    2. createEvent を使ってカレンダーイベントを作成する
    3. searchMemories を使って競合を検索する`
  })

  return result.toAIStreamResponse()
}
```

<div id="environment-setup">
  ## 環境セットアップ
</div>

すべての例で、次の環境変数が設定されていることを確認してください:

```bash .env.local
SUPERMEMORY_API_KEY=your_supermemory_key
OPENAI_API_KEY=your_openai_key
ANTHROPIC_API_KEY=your_anthropic_key
```

<div id="best-practices">
  ## ベストプラクティス
</div>

<div id="memory-tools">
  ### Memory Tools
</div>

* 検索精度を高めるために、内容を明確にしたメモリーを用意する
* 各ツールをいつ使うべきかを、systemプロンプトにコンテキストとして明示する
* ユースケースごとに分けるため、プロジェクトのヘッダーを活用する
* ツールの失敗に備え、エラーハンドリングを実装する

<div id="infinite-chat">
  ### Infinite Chat（インフィニット・チャット）
</div>

* 会話IDを使ってチャットごとのコンテキストを分離して維持する
* パーソナライズのためにユーザーIDを付与する
* ユースケースに最適なものを見つけるため、異なるプロバイダで検証する
* コスト最適化のためにトークン消費量を監視する

<div id="general-tips">
  ### 一般的なヒント
</div>

* まずはシンプルな例から始め、徐々に複雑さを加えていく
* 検索機能を活用して保存メモリの重複を避ける
* 本番環境では適切な認証を実装する
* 大量トラフィックのアプリケーションではレート制限の導入を検討する

<div id="next-steps">
  ## 次のステップ
</div>

<CardGroup cols={2}>
  <Card title="Memory API" icon="database" href="/ja/memory-api/overview">
    APIをフルに活用した高度なメモリー管理
  </Card>

  <Card title="Memory Router" icon="route" href="/ja/memory-router/overview">
    既存のLLMアプリにそのまま挿し替えできるプロキシ
  </Card>
</CardGroup>